---
title: "README"
author: "Isabelle Boulangeat"
date: "`r format(Sys.time(), '%d/%m/%y')`"
output:
  html_document:
    keep_md: true
    variant: gmf
editor_options:
  chunk_output_type: console
always_allow_html: yes
---

```{r setup, include=FALSE}
library(knitr)
# library(kableExtra)
knitr::opts_chunk$set(echo = TRUE)
# library(Jmisc)
library(tidyr)
sapply(list.files("R_fct"), function(x)source(paste0("R_fct/",x)))
require(sp)
require(dplyr)
require(ggplot2)
require(ggmap)
require(sf)
require(raster)
require(terra)
require(stars)
require(starsExtra)
require(shadow)
require(rgdal)
require(mapview)
```

# Données

<!-- ## Données de présence de Erica Carnea -->
<!-- ```{r visudata, echo = FALSE, fig = TRUE} -->
<!-- library(leaflet)  -->
<!-- library(leafem) -->
<!-- library(stars) -->
<!-- sites_all = read.csv("_data_prod/sites_all.csv") -->
<!-- rasalti = raster('_data_prod/DEM90_sa.tif') -->
<!-- staralti= read_stars("_data_prod/DEM90_sa.tif", proxy = FALSE,  package="stars") -->

<!-- rasaltiwm = raster('_data_prod/DEM90_sa_wo_merc.tif') -->
<!-- staraltiwm= read_stars("_data_prod/DEM90_sa_wo_merc.tif", proxy = FALSE,  package="stars") -->

<!-- leaflet(sites_all)%>% -->
<!--   addProviderTiles("OpenStreetMap.HOT")%>% -->
<!--   leafem::addGeoRaster(staralti, opacity = 0.6, colorOptions = colorOptions(palette = "Blues")) %>% -->
<!--   setView(lng=5.5,lat=45,zoom=6) %>% -->
<!--   leafem::addGeoRaster(staraltiwm, opacity = 0.6, colorOptions = colorOptions(palette = "Reds")) %>% -->
<!--   setView(lng=5.5,lat=45,zoom=6) %>% -->
<!--   addCircleMarkers(lng = ~lon_wgs84, lat = ~lat_wgs84, popup = ~date, radius = 0.3, opacity = 0.8, color = "black")  -->


<!-- ``` -->


## Variables explicatives pour le modèle de distribution
```{r varexpl}
rf = readRDS("rfmod__all.rds")
rf.ericar = rf$rfmod
library(randomForest)
varImpPlot(rf.ericar)
```

## Prediction / projection

```{r predict, fig = TRUE}
library(leaflet)
library(leafem)
library(stars)
sites_all = read.csv("_data_prod/sites_all.csv")

rf.predict.ericar.p= read_stars("_data_prod/rf.predict.ericar_prob_wm30_wm.tif", proxy = FALSE,  package="stars")
rf.values.p = raster("_data_prod/rf.predict.ericar_prob_wm30_wm.tif")

leaflet(sites_all)%>%
  addProviderTiles("OpenStreetMap.HOT")%>%
  leafem::addGeoRaster(rf.predict.ericar.p, opacity = 0.8, colorOptions = colorOptions(palette = colorRampPalette(c("lightblue", "violet", "darkviolet"), space="Lab"))) %>%
  setView(lng=5.5,lat=45,zoom=6) %>%
  addCircleMarkers(lng = ~lon_wgs84, lat = ~lat_wgs84, popup = ~date, radius = 0.3, opacity = 0.8, color = "black") 

```
